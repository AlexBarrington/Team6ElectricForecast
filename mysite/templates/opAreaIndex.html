<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by TEMPLATED
http://templated.co
Released for free under the Creative Commons Attribution License

Name       : Skeleton
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20130902

-->
{% extends "layout.html" %}
{% block statics %}
{% load staticfiles %}
<link href="{% static "css/default.css" %}" rel="stylesheet" type="text/css" media="all" />
<link href="{% static "css/fonts.css" %}" rel="stylesheet" type="text/css" media="all" />

<!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
{% endblock %}
{% block content %}

   <script src="/static/js/papaparse.js"></script>
   <script src="/static/js/jquery-1.11.3.js"></script>
   <script src="/static/js/dygraph.js"></script>

<!--   <div>
	<input type = "file" id="fileInput">
` </div> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
  <script>
	  
	var opArea = "{{ opArea }}"
	var url = "http://127.0.0.1:8000/data/" + opArea + "/"
	var dataText;
	var dataArray;
	
	var xHR = new XMLHttpRequest();
	xHR.onload = handleStateChange;
	xHR.open("GET", url);
	xHR.send();
	console.log("Request Sent");
	
	function handleStateChange(){
		if( xHR.status >= 200 &&
			xHR.status < 300) {
		console.log("Got Response");
		//console.log(xHR.responseText);
		dataText = xHR.responseText;
		console.log("data: " + dataText);
		}
		
		dataArray = processData(dataText);
		//drawGraphs(dataArray);
	}
	
	function processData(dataText) {
		dataText = String(dataText);
		var allTextLines = dataText.split(/\n/);
		var headers = allTextLines[0].split(',');
		var load = [];
		var temp = [];
		var wind = [];
		console.log(headers);
		for (var i=1; i<allTextLines.length; i++) {
			var data = allTextLines[i].split(',');
			if (data.length == headers.length) {

				var loadLine = [];
				var tempLine = [];
				var windLine = [];
				for (var j=0; j<headers.length; j++) {
					if(j==0){
						var dateString = (data[0] + " " + data[1]);
						var date = new Date(dateString)
						loadLine[0] = date;
						tempLine[0] = date;
						windLine[0] = date;
					}
					if(j==2){
						loadLine[1] = (Number(data[j]));
					}
					if(j==3){
						tempLine[1] = (Number(data[j]));
					}
					if(j==4){
						windLine[1] = (Number(data[j]));
					}
					if(j==5){
						loadLine[2] = (Number(data[j]));
					}
					if(j==6){
						tempLine[2] = (Number(data[j]));
					}
					if(j==7){
						windLine[2] = (Number(data[j]));
					}
				}
				load.push(loadLine);
				temp.push(tempLine);
				wind.push(windLine);
				console.log(load.constructor.toString().indexOf("Array") > -1);
			}
		}
		 console.log(load);
		 console.log(temp);
		 console.log(wind);
		 drawGraphs(load, temp, wind);
		 //return load;
	}
	
	function drawGraphs(load, temp, wind){
		console.log("made it to the callback")
			
		
		// $(document).ready(function () {
      new Dygraph(
          document.getElementById("load"),
          load,
          {
			labels: ["time", "actual load", "forecasted load"],
            title: 'Load for {{ opArea }}',
            ylabel: 'Load (MW)',
            legend: 'always',
            labelsDivStyles: { 'textAlign': 'center' },
            showRangeSelector: true,
			rangeSelectorHeight: 30,
			
          }
      );
      new Dygraph(
          document.getElementById("temp"),
          temp,
          {

			labels: ["time", "actual temperature", "forecasted temperature"],
            title: 'Temperatures for {{ opArea }}',
            ylabel: 'Temperature (F)',
            legend: 'always',
            labelsDivStyles: { 'textAlign': 'right' },
            showRangeSelector: true,
            rangeSelectorHeight: 30,
          });
		  
	new Dygraph(
          document.getElementById("windSpeed"),
          wind,
          {

			labels: ["time", "actual wind speed", "forecasted wind speed"],
            title: 'Wind Speed for {{opArea}}',
            ylabel: 'Wind Speed (mph)',
            legend: 'always',
			//valueRange: [-5, 25],
            labelsDivStyles: { 'textAlign': 'right' },
            showRangeSelector: true,
            rangeSelectorHeight: 30,
          });
    //}
	}
	
	
	
  </script>
  <div id="welcome">
			<div class="title">
				<font size="+8">{{ pageTitle }}</font>
				<span class="byline">{{ opArea }}</span>
			</div>
			<p>This is <strong>{{ opArea }}</strong>, showing the contrast between forecasted and actual electrical load</p>
			<p><br></p>
			<div id="featured">
				<div class="title">
					<h2>Graphs</h2>
				</div>
				<div id="load" style="width:775px; height:300px;"></div>
				<p><br><br><br></p>
				<div id="temp" style="width:775px; height:300px;"></div>
				<p><br><br><br></p>
				<div id="windSpeed" style="width:775px; height:300px;"></div>
			</div>
			<ul class="actions">
				<li><a href="#" class="button"></a></li>
			</ul>
		</div>
		<div id="featured">
			<div class="title">
				<h2>Statistics</h2>
				<span class="byline">A quick look at how {{ opArea }} is doing</span>
			</div>
			<ul class="style1">
				<li class="first">
					<p class="date"><a href="#">Jan<b>05</b></a></p>
					<h3>Amet sed volutpat mauris</h3>
					<p><a href="#">Consectetuer adipiscing elit. Nam pede erat, porta eu, lobortis eget, tempus et, tellus. Etiam neque. Vivamus consequat lorem at nisl. Nullam non wisi a sem semper eleifend. Etiam non felis. Donec ut ante.</a></p>
				</li>
				<li>
					<p class="date"><a href="#">Jan<b>03</b></a></p>
					<h3>Sagittis diam dolor amet</h3>
					<p><a href="#">Etiam non felis. Donec ut ante. In id eros. Suspendisse lacus turpis, cursus egestas at sem. Mauris quam enim, molestie. Donec leo, vivamus fermentum nibh in augue praesent congue rutrum.</a></p>
				</li>
				<li>
					<p class="date"><a href="#">Jan<b>01</b></a></p>
					<h3>Amet sed volutpat mauris</h3>
					<p><a href="#">Consectetuer adipiscing elit. Nam pede erat, porta eu, lobortis eget, tempus et, tellus. Etiam neque. Vivamus consequat lorem at nisl. Nullam non wisi a sem semper eleifend. Etiam non felis. Donec ut ante.</a></p>
				</li>
				<li>
					<p class="date"><a href="#">Dec<b>31</b></a></p>
					<h3>Sagittis diam dolor amet</h3>
					<p><a href="#">Etiam non felis. Donec ut ante. In id eros. Suspendisse lacus turpis, cursus egestas at sem. Mauris quam enim, molestie. Donec leo, vivamus fermentum nibh in augue praesent congue rutrum.</a></p>
				</li>
			</ul>
		</div>
		{% endblock %}
		{% block copyright %}
		<div id="copyright">
			<span>&copy; Untitled. All rights reserved. | Design by <a href="http://templated.co" rel="nofollow">TEMPLATED</a>.</span>
		</div>
		{% endblock %}
	</div>
</div>

</html>
